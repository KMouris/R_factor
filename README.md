# Purpose
Python package for calculating the R factor based on gridded data with high temporal resolution

Main code is RFactor_5, whereas RasterManipulation_2 is used to pre-process the raw data

# RFactor_5

Calculates the R factor on a per storm, per month and per year basis for each cell in the original Raster, and generates an output raster for each time frame with the corresponding R factors for each cell. The resulting Rasters can be opened in GIS program in order to be used in the RUSLE equation. 

## Input data
### Storm event input
* time_interval: User must input the time discretization of the precipitation records. This input will be checked with one of the input files. If the input value doesn’t coincide with input files, then an error is produced. 
* min_6Hours: minimum precipitation value (in mm) in a 6 hour time step that must be met in order to either start a storm event or decide when the event ends. If this value is set to 0, a storm will start when a precipitation record is greater than 0, and will end when, in a 6 hour window, the total precipitation is 0. Panagos et al, (2015) sets this value at 1.27 mm. 
* min_P: minimum total storm precipitation (in mm) in order to consider the given storm as erosive. If the value is set to 0, all storms will be considered, regardless of the total precipitation value. Panagos et. Al (2015) sets this value as 12.7 mm. 
* CF:  If the user input time interval is equal to 60 min (hourly discretization of data), the user can choose whether or not to consider an R Factor conversion factor, to take into consideration the error induced by an hourly discretization. True indicates the program to use the conversion, False to ignore the conversion factor. 

### Temperature input
* min_temp: minimum temperature threshold (in °C). Temperatures below the given value will not be considered as erosive, so they will not be taken into consideration when determining the start and end of a precipitation event

### Original raster data
This data must be modified if rasters different from the dirt-X rasters are being used. The data correspond to the coordinates (location) and cell size of the rasters being used. This information is the same for all original input rasters (precipitation and temperature) being used.
* original_rows: number of rows in the original precipitation and temperature raster files 
* original_columns: number of columns in the original precipitation and temperature raster files
* xllcorner: X coordinate of the origin of the original precipitation and temperature raster files
* yllcorner: Y coordinate of the origin of the original precipitation and temperature raster files
* cellsize: cell size of the original precipitation and temperature raster files 

### Directory paths
* path: folder directory where the .csv files for each raster cell is located. The files must be comma-delimited .csv files (generated by RasterManipulation_2 program). 
* save_path_storm: folder directory where the .csv files with the per-storm R factor results will be saved (no need for input if SaveCSV(df_storm, name, save_path_storm command is commented out, see Figure 4)
* save_path_month: folder directory where the .csv files with the monthly R-factor results will be stored. (no need for input if SaveCSV(df_storm, name, save_path_month command is commented out, see Figure 4)
* Save_path_raster: file directory where the monthly and yearly R Factor result rasters for the entire watershed will be saved. 

## Output data
* Per-Storm R Factor results: Comma-delimited .csv file with the results for each storm in the given cell. File name corresponds to the original row_column of the given cell. Includes storm start date, storm end date, total storm duration, total storm precipitation, maximum storm 30 minute intensity (mm/h), storm kinetic energy (KE), and storm R Factor (EI30) 
    * Program generates a file for each cell in the original raster (2897 files)
    * User can decide to not generate the files by commenting the code “SaveCSV(df_storm, name, save_path_storm)
* Per-Month R Factor results: Comma-delimited .csv file with the R factor result for each month in the given time frame, for each cell. Includes Month-Year and total R factor 
    * Program generates a file for each cell in the original raster (2897 files)
    * User can decide to not generate the files by commenting the code “SaveCSV(df_storm, name, save_path_month)
* Raster files: tab delimited .txt files (ASCII Raster format), for each month and for each year, with R factor results. Each cell contains the corresponding R Factor value. 
    * Generated by command “SaveRaster(R_3D_months, R_3D_years, save_path_raster)”
    * Program generates file for each month-year combination and for each year in the given time frame. 
    * File name corresponds to “month_year” combination  or “year”
    * In order to open the Raster files in ArcGIS, the command “ASCII to Raster” tool must be used. 



# RasterManipulation_2 

Its main purpose is to convert the received precipitation and temperature into .csv files that can be used to calculate the R factor for each cell with the program RFactor_5. 
    
## Input data
* path_precip = folder location where the precipitation rasters are found
    * Files must be in .txt form    
    * File name must be in the format: YearMonthDay_Hour (YYYYMMDD_0HH)
* path_temp= folder location where the temperature rasters are found
    * Files must be in .txt form 
    * File name must be in the format: YearMonthDay_Hour (YYYYMMDD_0HH)
    * There must be one temperature file for each precipitation file. 
    * Temperature and precipitation rasters must have the same resolution (same number of cells)
    * It is not mandatory to introduce temperature values (see input file 4)
* savepath= folder location where the .csv files created by the program will be saved
* temp= binary variable
    * True means you are introducing temperature files. 
    * False means you are not introducing temperature files. In the resulting file, the temperature value will be 9999
    
## Output data
= .csv file for each cell, containing the precipitation value for each available time interval
* File name: OriginalRow_OriginalColumn in the raster
    * This information will be used in the “RFactor_5” program in order to recreate the original raster, assigning the corresponding R factor to each cell, in its original position

## Error checks 
The program checks for the following information: 
* If the input file directories and the result directories exist 
* If there are an equal number of precipitation and temperature files, in case the temp binary variable is True 
* It does NOT check if the precipitation files and temperature files correspond to the same dates. It combines the precipitation with the temperature in the same order they are read in the folder 

## Main functions in the program
A detailed description of the functions is included in the user manual.
